pipeline{
    agent{
        docker{
            image'node:19-alpine'
        }
    }

stages{
    stage('test'){
        steps{
            echo 'node version'
            sh 'node --version'
        }
    }
stage('checkout'){
    steps{
        git branch : 'main' , url : 'https://github.com/norbertwise/building-docker-images.git'
    }

}

stage('docker build & push'){
    environment{
         DOCKER_IMAGE = "node:19-alpine"
    REDISTRY_CREDENTIALS = credentials('docker_cred')  
     }
   steps{
    scripts{
        docker.withRegistry('https://index.docker.io/v1.0', "docker_cred") 
        
        def customImage = docker.build("patnorbs/myapp:v1.0"){
            customImage.push()
        }

   
    }

   }
    
}


}


}