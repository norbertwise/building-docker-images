pipeline{
    agent{
        docker{
            image'node:19-alpine'
        }
    }

stages{
    stage('test'){
        steps{
            echo 'node version'
            sh 'node --version'
        }
    }
stage('checkout'){
    steps{
        git branch : 'main' , url : 'https://github.com/norbertwise/building-docker-images.git'
    }

}

stage('docker build & push'){
    steps{
        docker.withRegistry('https://registry.hub.docker.com', "docker_cred") 
        withCredentials([usernamePassword(credentialsId: 'docker_cred', passwordVariable: 'dockerHubPassword', usernameVariable: 'dockerHubUser')]) {
          sh "docker login -u ${env.dockerHubUser} -p ${env.dockerHubPassword}"
          sh 'docker build -t webapp:v1.2 .'
          sh 'docker push patnorbs /webapp:v1.2'
        }
    }
}

}  
   
}
   
    

   
    






